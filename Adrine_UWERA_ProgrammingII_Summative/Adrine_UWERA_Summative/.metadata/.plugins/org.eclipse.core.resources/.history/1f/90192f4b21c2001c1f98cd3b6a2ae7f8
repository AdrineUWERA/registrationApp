// indicates the package in which the class is in
package ALU;

// imports all the classes needed for the sign up Page (JComponents, sql connection, and event listeners
// and actionEvent)
import java.awt.event.ActionEvent;
import java.awt.event.ActionListener;
import java.sql.Connection;
import java.sql.DriverManager;
import java.sql.ResultSet;
import java.sql.SQLException; 
import java.sql.Statement;

import javax.swing.JButton;
import javax.swing.JLabel;
import javax.swing.JPanel;
import javax.swing.JTextField;

// class for sign up page
public class SignUpPage {
	// declares a JPanel attribute for the sign up page
	JPanel signUpPanel;
	
	// declares labels attributes for the fields on the sign up page
	JLabel result;
	JLabel nameLabel;
	JLabel emailLabel;
	JLabel passwordLabel;
	JLabel confirmPasswordLabel;
	
	// declares text field attributes to take in user input for each required information to sign up
	JTextField name;
	JTextField email;
	JTextField password;
	JTextField confirmPassword;

	// declares a button for submitting
	JButton signupBtn;
	
	// constructor for the sign up page
	public SignUpPage() {
		// creates the JPanel for the sign up page
		// this will be a container of the page
		signUpPanel = new JPanel();
		
		// creates a label for the name field
		nameLabel = new JLabel("Full name: ");  
		// positions and set size of the name label
		nameLabel.setBounds(50, 50, 350, 20); 
		// creates the text field for the name
		name = new JTextField();
		// positions and set size of the text field for the name 
		name.setBounds(50, 80, 350, 30); 
		
		//creates a label for the email field
		emailLabel = new JLabel("Email: "); 
		// positions and set size of the email label
		emailLabel.setBounds(50, 120, 300,30); 
		// creates the text field for the email
		email = new JTextField();
		// positions and set size of the text field for the email
		email.setBounds(50,160, 350, 30); 
		
		//creates a label for the password field
		passwordLabel = new JLabel("Password: ");  
		// positions and set size of the password label
	    passwordLabel.setBounds(50,200, 300,30);
	    // creates the text field for the password
		password = new JTextField();
		// positions and set size of the text field for the password
		password.setBounds(50,240, 350,30);  
	    
		//creates a label for the confirm password field
		confirmPasswordLabel = new JLabel("Confirm Password: ");  
		// positions and set size of the confirm password label
		confirmPasswordLabel.setBounds(50,280, 300,30); 
		// creates the text field for the confirm password
		confirmPassword = new JTextField();
		// positions and set size of the text field for the confirm password
		confirmPassword.setBounds(50,320, 350,30); 
		
		//creates a label that will inform the user what's missing or if the sign up was successful
		result = new JLabel("");  
		// positions and set size of result label
		result.setBounds(50,20, 300,30); 
		
	    // creates a button to submit i.e sign up		    
		signupBtn =  new JButton("Sign Up");
		signupBtn.setBounds(50,380,100,30);  
		signupBtn.setEnabled(true);
	   
		// add all the components to the sign up panel
		signUpPanel.add(result);
		signUpPanel.add(name);
	    signUpPanel.add(email);
	    signUpPanel.add(password);
	    signUpPanel.add(confirmPassword);
	    signUpPanel.add(nameLabel);
	    signUpPanel.add(emailLabel);
	    signUpPanel.add(passwordLabel);
	    signUpPanel.add(confirmPasswordLabel);
	    signUpPanel.add(signupBtn); 
		
		
		signupBtn.addActionListener(new ActionListener() {
	
			@Override
			public void actionPerformed(ActionEvent e) {
				String studentName = name.getText();
				String studentEmail = email.getText();
				String studentPassword = password.getText();
				String confPassword = confirmPassword.getText();
				String atEmail = "@";
				String dot = ".";
				
				if (studentName.length() > 0 & studentEmail.indexOf(atEmail) > -1 & studentEmail.indexOf(dot) > -1 &
						studentPassword.length() >= 4 & studentPassword.equals(confPassword)) {				
					try { 
						
						//1. Create database connection
						Connection myConn = DriverManager.getConnection(
					            "jdbc:mysql://localhost:3306/alu_registration_database","root", "");
						
						//2. Create a statement
						Statement mySt = myConn.createStatement();
						
						//3. Execute sql query
						String selectQuery = "select* from login_credentials_table where 'email' = "
								+ "(\"" + studentEmail + "\");";
						ResultSet matchingData = mySt.executeQuery(selectQuery);
						

						//3. Execute sql query
						String insertQuery = "insert into login_credentials_table (studentName, email, password) values"
								+ "(\"" + studentName + "\",\"" + studentEmail + "\",\"" + studentPassword + "\");";
						
						mySt.executeUpdate(insertQuery);
						
						System.out.println("Inserted successfully");	// green color
						result.setText("Signed Up successfully");

											
					}
					
					catch(SQLException exception) {
						if(exception.getErrorCode() == 0 ){
							System.out.println("Database connection failed. Please check if your database is connected."); 
						}
						else if(exception.getErrorCode() == 1062 ){
							result.setText("The provided email already has an account.");
						}
						else {
							exception.printStackTrace();
						}
					}
					
				} 
				else { 
					
					if (studentName.length() == 0) {
						result.setText("Full name field is empty.");
					}
					else if (studentEmail.indexOf(atEmail) < 0 & studentEmail.indexOf(dot) < 0) {
						result.setText("Invalid email.");
					}
					else if (studentPassword.length() < 4) {       // red color
						result.setText("Password must be at least 4 characters");
					}
					else if (studentPassword != confPassword) {
						result.setText("Passwords don't match");
					}
					else {
						result.setText("verify your entries");
					}
				}
				
			}
			
		});
		
		
		signUpPanel.setSize(460,500);  
		signUpPanel.setLayout(null);  		
		signUpPanel.setVisible(true); 
	}
	
	
}
